{% extends "base.html" %}

{% block content %}
<script>var role = '{{role}}'; var id = {{id}}; var fen = '{{game.fen}}'</script>
<script src="{{ url_for('static', filename='js/game.js') }}"></script>

{% if (white_player is none or black_player is none) and type != 'engine' %}
    {% if not current_user.is_authenticated %}
        <div class="message">Незарегистрированный пользователь не может принять игру.</div>
    {% else %}
        {% if type == 'fast' %}
            <div class="message">Подождите, пока мы подберем вам соперника...</div>
        {% else %}
            <div class="message">Отправьте эту ссылку вашему сопернику: {{ url }}. Первый, кто пройдет по ней, сыграет с вами. </div>
        {% endif %}
    {% endif %}
{% else %}
    {% if role == 'black' %}
        {% set board = board[::-1] %}
    {% endif %}

<div class="party">
    <div class="game-info">
        {% if end_game %}
            <div class="end">{{ result }} • {{ reason }}</div>
        {% else %}
            <div class="end"></div>
        {% endif %}
        {% if white_player != none %}
            <div>Белые: <a href="/profile/{{ white_player.id }}" class="user-link">{{ white_player.nick }}</a> {{ white_player.rating }}</div>
        {% else %}
            <div>Белые: Stockfish</div>
        {% endif %}
        {% if black_player != none %}
            <div>Черные: <a href="/profile/{{ black_player.id }}" class="user-link">{{ black_player.nick }}</a> {{ black_player.rating }}</div>
        {% else %}
            <div>Черные: Stockfish</div>
        {% endif %}
        <div>{{ type|capitalize }}</div>
        {% if end_game %}
            <div class="analysis"><a href="../analysis/{{ id }}" class="analysis-link">Анализировать партию</a></div>
        {% else %}
            <div class="analysis"><a href="../analysis/{{ id }}" class="analysis-link"></a></div>
        {% endif %}
    </div>

<div class="chess-board">
    <div id="chessboard"></div>
</div>
<br>
</div>
{% endif %}

{% endblock %}