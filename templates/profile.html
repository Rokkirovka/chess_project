{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
<script>
    function showContent(contentId) {
        $(".tab-content").children().hide();
        $("#" + contentId).show();
    }
</script>

<div class="profile">
    <div class="statistic">
        <div class="statistic-items">
            <p class="statistic-item">{{ user.nick }}</p>
            <p class="statistic-item">Статистика</p>
            <p class="statistic-item">Дата регистрации: {{ user.registration_date.date() }} </p>
            <p class="statistic-item">Рейтинг: {{ user.rating }}</p>
            <p class="statistic-item">Завершенных игр: {{ all_games | length }}</p>
            <p class="statistic-item">Незавершенных игр: {{ unfinished_games | length }}</p>
            {% if all | length == 0 %}
            <p class="statistic-item">Процент побед: <span>0%</span> </p>
            <p class="statistic-item">Процент ничьих: <span>0%</span> </p>
            <p class="statistic-item">Процент поражений: <span>0%</span> </p>
            {% else %}
            <p class="statistic-item">Процент побед: <span>{{ (wins | length / all | length * 100) | round(2) }}%</span> </p>
            <p class="statistic-item">Процент ничьих: <span>{{ (draws | length / all | length * 100) | round(2) }}%</span> </p>
            <p class="statistic-item">Процент поражений: <span>{{ (looses | length / all | length * 100) | round(2) }}%</span> </p>
            {% endif %}
        </div>
    </div>

    <div class="games">
        <div class="tab">
            <div class="tab-content">
                <div id="win">
                    {{wins}}
                </div>
                <div id="loose" style="height: 95%;">
                    <table style="width: 100%; margin: 20px; overflow-y:scroll; height: 100%; display:block;">
                        <tbody>
                            {% for game in looses %}
                                <tr>
                                    <td rowspan="5">
                                        <a href="/game/{{game.id}}"><div id="{{ 'board' + game.id|string }}" style="width: 300px"></div></a>
                                        <script>var board = Chessboard('board' + {{game.id|string}}, {
                                                    position: '{{game.fen}}',
                                                    pieceTheme: '../static/img/chesspieces/wikipedia/{piece}.png',
                                                    showNotation: false
                                        })
                                        </script>
                                    </td>
                                    <td>Партия {{ game.id }}</td>
                                </tr>
                                <tr><td>Белые: {{ game.white_player }}</td></tr>
                                <tr><td>Черные: {{ game.black_player }}</td></tr>
                                <tr><td>Результат: {{ game.result }}</td></tr>
                                <tr><td><a href="/analysis/{{ game.id }}">Анализировать партию</a></td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div id="draw">
                    <table>
                        <tbody>
                            {% for game in draws %}
                                <tr>{{ game }}</tr>
                            {% endfor %}
                        </tbody>>
                    </table>
                </div>
            </div>
            <div class="tab-nav">
                <input checked id="win-btn" name="tab-btn" type="radio" value="">
                <label for="win-btn" onclick="showContent('win')">Победы</label>
                <input id="loose-btn" name="tab-btn" type="radio" value="">
                <label for="loose-btn" onclick="showContent('loose')">Поражения</label>
                <input id="draw-btn" name="tab-btn" type="radio" value="">
                <label for="draw-btn" onclick="showContent('draw')">Ничьи</label>
                <input id="tab-btn-4" name="tab-btn" type="radio" value="">
                <label for="tab-btn-4">Текущие</label>
            </div>
        </div>
    </div>
</div>

{% endblock %}